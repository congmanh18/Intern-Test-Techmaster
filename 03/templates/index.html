<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Process AI</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Auto Process AI</h1>

        <label for="model">ğŸ” Chá»n mÃ´ hÃ¬nh AI:</label>
        <select id="model">
            <option value="gemma2-9b-it">Google</option>
            <option value="llama-3.3-70b-versatile">Meta</option>
            <option value="mixtral-8x7b-32768">Mistral</option>
            <option value="deepseek-r1-distill-llama-70b">DeepSeek</option>
        </select>

        <button onclick="startAutoProcess()">ğŸš€ Báº¯t Ä‘áº§u xá»­ lÃ½</button>
        <div id="response-container">
            <h3>Káº¿t quáº£:</h3>
            <h4>ğŸ“œ Há»™i thoáº¡i:</h4>
            <div id="dialogue"></div>
            <h4>ğŸ“Œ Tá»« quan trá»ng:</h4>
            <div id="important-words"></div>
            <h4>ğŸŒ Dá»‹ch sang tiáº¿ng Anh:</h4>
            <div id="translated-words"></div>
        </div>
        <hr>

        <h2>ğŸ“œ API: Láº¥y ID há»™i thoáº¡i</h2>
        <button onclick="getAllDialogIDs()">ğŸ“Œ Láº¥y táº¥t cáº£ ID há»™i thoáº¡i</button>
        <div id="dialog-ids"></div>

        <hr>

        <h2>ğŸ“œ API: Láº¥y há»™i thoáº¡i & tá»« vá»±ng</h2>
        <label for="dialog-id-input">Nháº­p ID há»™i thoáº¡i:</label>
        <input type="text" id="dialog-id-input" placeholder="Nháº­p ID..." />
        <button onclick="getDialogAndWords()">ğŸ“– Láº¥y há»™i thoáº¡i</button>

        
    </div>

    <script>
        function startAutoProcess() {
            const model = document.getElementById("model").value;
            document.getElementById("dialogue").innerHTML = "â³ Äang xá»­ lÃ½...";
            document.getElementById("important-words").innerHTML = "";
            document.getElementById("translated-words").innerHTML = "";

            fetch("/auto-process", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ model: model })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById("dialogue").innerHTML = `<p style='color: red;'>âŒ ${data.error}</p>`;
                } else {
                    document.getElementById("dialogue").innerHTML = marked.parse(data.Dialogue);
                    document.getElementById("important-words").innerHTML = marked.parse(data.ImportantWords);
                    document.getElementById("translated-words").innerHTML = marked.parse(data.TranslatedWords);
                }
            })
            .catch(error => {
                document.getElementById("dialogue").innerHTML = "<p style='color: red;'>âŒ Lá»—i káº¿t ná»‘i API</p>";
            });
        }

        function getAllDialogIDs() {
            document.getElementById("dialog-ids").innerHTML = "â³ Äang táº£i...";
            fetch("/api/dialogs/ids")
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById("dialog-ids").innerHTML = `<p style='color: red;'>âŒ ${data.error}</p>`;
                } else {
                    document.getElementById("dialog-ids").innerHTML = "<b>Danh sÃ¡ch ID:</b><br>" + data.dialog_ids.join(", ");
                }
            })
            .catch(error => {
                document.getElementById("dialog-ids").innerHTML = "<p style='color: red;'>âŒ Lá»—i káº¿t ná»‘i API</p>";
            });
        }

        function getDialogAndWords() {
            const dialogID = document.getElementById("dialog-id-input").value.trim();
            if (!dialogID) {
                alert("Vui lÃ²ng nháº­p ID há»™i thoáº¡i!");
                return;
            }

            document.getElementById("dialogue").innerHTML = "â³ Äang táº£i...";
            document.getElementById("important-words").innerHTML = "";
            document.getElementById("translated-words").innerHTML = "";

            console.log("Fetching data for dialog ID:", dialogID);

            fetch(`/api/dialogs/${dialogID}`)
            .then(response => {
                console.log("Response status:", response.status);
                return response.json();
            })
            .then(data => {
                console.log("Response data:", data);
                if (data.error) {
                    document.getElementById("dialogue").innerHTML = `<p style='color: red;'>âŒ ${data.error}</p>`;
                } else {
                    document.getElementById("dialogue").innerHTML = marked.parse(data.dialog.content || "");
                    
                    // Hiá»ƒn thá»‹ tá»« quan trá»ng dáº¡ng danh sÃ¡ch
                    const wordsList = data.words.map(word => `<li>${word.content} - <b>${word.translate}</b></li>`).join("\n");
                    document.getElementById("translated-words").innerHTML = `<ul>${wordsList}</ul>`;
                }
            })
            .catch(error => {
                console.error("Fetch error:", error);
                document.getElementById("dialogue").innerHTML = "<p style='color: red;'>âŒ Lá»—i káº¿t ná»‘i API</p>";
            });
        }

    </script>
</body>
</html>
